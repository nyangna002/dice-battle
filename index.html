<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Dice Battle</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, onValue, get, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB5DBFCeHAy0ZhM3ITwu4MklaGqtqv9vhU",
  authDomain: "dice-7fe9a.firebaseapp.com",
  databaseURL: "https://dice-7fe9a-default-rtdb.firebaseio.com",
  projectId: "dice-7fe9a",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const gameRef = ref(db, "rooms/room1");

const myId = prompt("A ë˜ëŠ” B ì…ë ¥");
const myName = prompt("ìºë¦­í„° ì´ë¦„");

document.body.innerHTML = `
<h2>${myName} (${myId})</h2>
<p>A HP: <span id="hpA">30</span></p>
<p>B HP: <span id="hpB">30</span></p>
<p>í„´: <span id="turn">A</span></p>
<button id="attack">ğŸ² ê³µê²©</button>
<ul id="logs"></ul>
`;

onValue(gameRef, snap => {
  const s = snap.val();
  if (!s) return;

  hpA.innerText = s.players.A.hp;
  hpB.innerText = s.players.B.hp;
  turn.innerText = s.turn;

  attack.disabled = s.turn !== myId;

  logs.innerHTML = "";
  s.logs.forEach(l => {
    const li = document.createElement("li");
    li.innerText = l;
    logs.appendChild(li);
  });
});

attack.onclick = async () => {
  const snap = await get(gameRef);
  const s = snap.val();
  if (s.turn !== myId) return;

  const target = myId === "A" ? "B" : "A";
  const dice = Math.floor(Math.random() * 20) + 1;

  await update(gameRef, {
    [`players/${target}/hp`]: s.players[target].hp - dice,
    turn: target,
    logs: [...s.logs, `${myName} â†’ d20 (${dice})`]
  });
};
</script>
</head>
<body></body>
</html>



